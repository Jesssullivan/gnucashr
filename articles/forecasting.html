<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Financial Forecasting • gnucashr</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Fira_Code-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Financial Forecasting">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">gnucashr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/getting-started.html">Get Started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>User Guides</h6></li>
    <li><a class="dropdown-item" href="../articles/getting-started.html">Getting Started</a></li>
    <li><a class="dropdown-item" href="../articles/consolidation.html">Multi-Book Consolidation</a></li>
    <li><a class="dropdown-item" href="../articles/forecasting.html">Financial Forecasting</a></li>
    <li><a class="dropdown-item" href="../articles/importing-data.html">Importing Data</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Technical Articles</h6></li>
    <li><a class="dropdown-item" href="../articles/performance-benchmarks.html">Performance Benchmarks</a></li>
    <li><a class="dropdown-item" href="../articles/rcpp-internals.html">Rcpp Internals</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news">
<li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="dropdown-item" href="../news/index.html">Version 0.2.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="https://gitlab.com/tinyland/projects/gnucashr" aria-label="GitLab (Primary)"><span class="fa fab fa-gitlab fa-lg"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Jesssullivan/gnucashr" aria-label="GitHub (Mirror)"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Financial Forecasting</h1>
            
      
      <small class="dont-index">Source: <a href="https://gitlab.com/tinyland/projects/gnucashr/blob/main/vignettes/forecasting.Rmd" class="external-link"><code>vignettes/forecasting.Rmd</code></a></small>
      <div class="d-none name"><code>forecasting.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>gnucashr provides a lazy forecasting system that builds computation
pipelines without executing until you call <code>collect()</code>. This
enables efficient scenario comparison, Monte Carlo simulation, and
sensitivity analysis.</p>
</div>
<div class="section level2">
<h2 id="the-lazyforecast-pattern">The LazyForecast Pattern<a class="anchor" aria-label="anchor" href="#the-lazyforecast-pattern"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tinyland.gitlab.io/projects/gnucashr">gnucashr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define entity configuration</span></span>
<span><span class="va">config</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  entities <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    corp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      revenue <span class="op">=</span> <span class="fl">100000</span>,</span>
<span>      operating_rate <span class="op">=</span> <span class="fl">0.70</span>,</span>
<span>      cogs_rate <span class="op">=</span> <span class="fl">0.25</span>,</span>
<span>      growth_rate <span class="op">=</span> <span class="fl">0.05</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Build a lazy forecast - NO computation yet</span></span>
<span><span class="va">forecast</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/forecast_expr.html">forecast_expr</a></span><span class="op">(</span><span class="va">config</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/lf_grow.html">lf_grow</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="fl">0.05</span>, months <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Inspect the plan without executing</span></span>
<span><span class="va">forecast</span><span class="op">$</span><span class="fu">show_plan</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># &lt;LazyForecast Plan&gt;</span></span>
<span><span class="co"># Source: config</span></span>
<span><span class="co"># Operations:</span></span>
<span><span class="co">#   1. grow (rate=5.00%, months=12)</span></span>
<span><span class="co"># Materialized: FALSE</span></span>
<span></span>
<span><span class="co"># Execute the forecast</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lf_collect.html">lf_collect</a></span><span class="op">(</span><span class="va">forecast</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data-sources">Data Sources<a class="anchor" aria-label="anchor" href="#data-sources"></a>
</h2>
<p>Forecasts can be built from multiple sources:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># From entity configuration</span></span>
<span><span class="va">f1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/forecast_expr.html">forecast_expr</a></span><span class="op">(</span><span class="va">config</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># From a GnuCash book</span></span>
<span><span class="va">gc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_gnucash.html">read_gnucash</a></span><span class="op">(</span><span class="st">"books.gnucash"</span><span class="op">)</span></span>
<span><span class="va">f2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/from_book.html">from_book</a></span><span class="op">(</span><span class="va">gc</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># From a book collection</span></span>
<span><span class="va">collection</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/book_collection.html">book_collection</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">collection</span><span class="op">$</span><span class="fu">add_book</span><span class="op">(</span><span class="st">"corp"</span>, <span class="st">"corp.gnucash"</span><span class="op">)</span></span>
<span><span class="va">f3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/from_collection.html">from_collection</a></span><span class="op">(</span><span class="va">collection</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># From raw data</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  entity <span class="op">=</span> <span class="st">"corp"</span>,</span>
<span>  revenue <span class="op">=</span> <span class="fl">100000</span>,</span>
<span>  expenses <span class="op">=</span> <span class="fl">70000</span></span>
<span><span class="op">)</span></span>
<span><span class="va">f4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/from_data.html">from_data</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="growth-projections">Growth Projections<a class="anchor" aria-label="anchor" href="#growth-projections"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Simple growth projection</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/forecast_expr.html">forecast_expr</a></span><span class="op">(</span><span class="va">config</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/lf_grow.html">lf_grow</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="fl">0.05</span>, months <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/lf_collect.html">lf_collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View projections</span></span>
<span><span class="va">result</span><span class="op">$</span><span class="va">projections</span></span>
<span></span>
<span><span class="co"># Compound vs simple growth</span></span>
<span><span class="va">compound</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/forecast_expr.html">forecast_expr</a></span><span class="op">(</span><span class="va">config</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/lf_grow.html">lf_grow</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="fl">0.05</span>, months <span class="op">=</span> <span class="fl">12</span>, compound <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/lf_collect.html">lf_collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">simple</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/forecast_expr.html">forecast_expr</a></span><span class="op">(</span><span class="va">config</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/lf_grow.html">lf_grow</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="fl">0.05</span>, months <span class="op">=</span> <span class="fl">12</span>, compound <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/lf_collect.html">lf_collect</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="scenario-comparison">Scenario Comparison<a class="anchor" aria-label="anchor" href="#scenario-comparison"></a>
</h2>
<p>Compare multiple scenarios without duplicating computation:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define scenarios</span></span>
<span><span class="va">base</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/forecast_expr.html">forecast_expr</a></span><span class="op">(</span><span class="va">config</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/lf_grow.html">lf_grow</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="fl">0.05</span>, months <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span>
<span></span>
<span><span class="va">optimistic</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/forecast_expr.html">forecast_expr</a></span><span class="op">(</span><span class="va">config</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/lf_grow.html">lf_grow</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="fl">0.08</span>, months <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pessimistic</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/forecast_expr.html">forecast_expr</a></span><span class="op">(</span><span class="va">config</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/lf_grow.html">lf_grow</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="fl">0.02</span>, months <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare scenarios</span></span>
<span><span class="va">comparison</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compare_forecasts.html">compare_forecasts</a></span><span class="op">(</span></span>
<span>  base <span class="op">=</span> <span class="va">base</span>,</span>
<span>  optimistic <span class="op">=</span> <span class="va">optimistic</span>,</span>
<span>  pessimistic <span class="op">=</span> <span class="va">pessimistic</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Access results</span></span>
<span><span class="va">comparison</span><span class="op">$</span><span class="va">base</span><span class="op">$</span><span class="va">cumulative_revenue</span></span>
<span><span class="va">comparison</span><span class="op">$</span><span class="va">optimistic</span><span class="op">$</span><span class="va">cumulative_revenue</span></span>
<span><span class="va">comparison</span><span class="op">$</span><span class="va">pessimistic</span><span class="op">$</span><span class="va">cumulative_revenue</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="monte-carlo-simulation">Monte Carlo Simulation<a class="anchor" aria-label="anchor" href="#monte-carlo-simulation"></a>
</h2>
<p>Run thousands of simulations with uncertain parameters:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Build Monte Carlo forecast</span></span>
<span><span class="va">mc_forecast</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/forecast_expr.html">forecast_expr</a></span><span class="op">(</span><span class="va">config</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/lf_monte_carlo.html">lf_monte_carlo</a></span><span class="op">(</span></span>
<span>    n <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      growth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">0.05</span>, sd <span class="op">=</span> <span class="fl">0.03</span><span class="op">)</span>,</span>
<span>      expense <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">0.70</span>, sd <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">42</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Execute (uses parallel Rcpp backend)</span></span>
<span><span class="va">mc_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lf_collect.html">lf_collect</a></span><span class="op">(</span><span class="va">mc_forecast</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Summary statistics</span></span>
<span><span class="va">mc_result</span><span class="op">$</span><span class="va">summary</span></span>
<span><span class="co"># Returns quantiles: p5, p25, p50, p75, p95</span></span>
<span></span>
<span><span class="co"># Extract specific quantile</span></span>
<span><span class="va">median_outcome</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_quantile.html">extract_quantile</a></span><span class="op">(</span><span class="va">mc_result</span>, <span class="fl">0.50</span><span class="op">)</span></span>
<span><span class="va">worst_case</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_quantile.html">extract_quantile</a></span><span class="op">(</span><span class="va">mc_result</span>, <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="va">best_case</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_quantile.html">extract_quantile</a></span><span class="op">(</span><span class="va">mc_result</span>, <span class="fl">0.95</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize</span></span>
<span><span class="fu"><a href="../reference/plot_monte_carlo.html">plot_monte_carlo</a></span><span class="op">(</span><span class="va">mc_result</span>, title <span class="op">=</span> <span class="st">"12-Month Cash Flow Projection"</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="quick-monte-carlo">Quick Monte Carlo<a class="anchor" aria-label="anchor" href="#quick-monte-carlo"></a>
</h3>
<p>For simple cases without building a full pipeline:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Quick Monte Carlo from config</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/quick_monte_carlo.html">quick_monte_carlo</a></span><span class="op">(</span></span>
<span>  <span class="va">config</span>,</span>
<span>  n_sims <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>  n_periods <span class="op">=</span> <span class="fl">12</span>,</span>
<span>  growth_mean <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  growth_sd <span class="op">=</span> <span class="fl">0.03</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">42</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Returns same structure as lf_monte_carlo</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="sensitivity-analysis">Sensitivity Analysis<a class="anchor" aria-label="anchor" href="#sensitivity-analysis"></a>
</h2>
<p>Analyze how outcomes change with different parameters:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Build sensitivity analysis</span></span>
<span><span class="va">sens_forecast</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/forecast_expr.html">forecast_expr</a></span><span class="op">(</span><span class="va">config</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/lf_sensitivity.html">lf_sensitivity</a></span><span class="op">(</span></span>
<span>    growth_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.02</span>, <span class="fl">0.10</span>, <span class="fl">0.01</span><span class="op">)</span>,</span>
<span>    expense_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.60</span>, <span class="fl">0.80</span>, <span class="fl">0.02</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Execute (uses parallel Rcpp backend)</span></span>
<span><span class="va">sens_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lf_collect.html">lf_collect</a></span><span class="op">(</span><span class="va">sens_forecast</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Access outcomes matrix</span></span>
<span><span class="va">sens_result</span><span class="op">$</span><span class="va">outcomes</span>  <span class="co"># growth × expense matrix</span></span>
<span></span>
<span><span class="co"># Visualize as heatmap</span></span>
<span><span class="fu"><a href="../reference/plot_sensitivity.html">plot_sensitivity</a></span><span class="op">(</span><span class="va">sens_result</span>, title <span class="op">=</span> <span class="st">"Sensitivity to Growth and Expense Rates"</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="quick-sensitivity">Quick Sensitivity<a class="anchor" aria-label="anchor" href="#quick-sensitivity"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Quick sensitivity from config</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/quick_sensitivity.html">quick_sensitivity</a></span><span class="op">(</span></span>
<span>  <span class="va">config</span>,</span>
<span>  growth_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.02</span>, <span class="fl">0.10</span>, <span class="fl">0.01</span><span class="op">)</span>,</span>
<span>  expense_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.60</span>, <span class="fl">0.80</span>, <span class="fl">0.02</span><span class="op">)</span>,</span>
<span>  n_periods <span class="op">=</span> <span class="fl">12</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="multi-entity-forecasting">Multi-Entity Forecasting<a class="anchor" aria-label="anchor" href="#multi-entity-forecasting"></a>
</h2>
<p>Forecast across multiple entities:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Configuration with multiple entities</span></span>
<span><span class="va">multi_config</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  entities <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    products <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>revenue <span class="op">=</span> <span class="fl">50000</span>, growth_rate <span class="op">=</span> <span class="fl">0.05</span>, operating_rate <span class="op">=</span> <span class="fl">0.65</span><span class="op">)</span>,</span>
<span>    services <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>revenue <span class="op">=</span> <span class="fl">70000</span>, growth_rate <span class="op">=</span> <span class="fl">0.08</span>, operating_rate <span class="op">=</span> <span class="fl">0.60</span><span class="op">)</span>,</span>
<span>    software <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>revenue <span class="op">=</span> <span class="fl">7000</span>, growth_rate <span class="op">=</span> <span class="fl">0.05</span>, operating_rate <span class="op">=</span> <span class="fl">0.30</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Forecast all entities</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/forecast_expr.html">forecast_expr</a></span><span class="op">(</span><span class="va">multi_config</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/lf_grow.html">lf_grow</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="st">"growth_rate"</span>, months <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/lf_collect.html">lf_collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Results by entity</span></span>
<span><span class="va">result</span><span class="op">$</span><span class="va">projections</span><span class="op">$</span><span class="va">products</span></span>
<span><span class="va">result</span><span class="op">$</span><span class="va">projections</span><span class="op">$</span><span class="va">services</span></span>
<span><span class="va">result</span><span class="op">$</span><span class="va">projections</span><span class="op">$</span><span class="va">software</span></span>
<span></span>
<span><span class="co"># Monte Carlo across all entities</span></span>
<span><span class="va">mc_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/monte_carlo_multi_entity.html">monte_carlo_multi_entity</a></span><span class="op">(</span></span>
<span>  <span class="va">multi_config</span>,</span>
<span>  n_sims <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>  n_periods <span class="op">=</span> <span class="fl">12</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    growth_sd <span class="op">=</span> <span class="fl">0.03</span>,</span>
<span>    expense_sd <span class="op">=</span> <span class="fl">0.05</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="parallel-execution">Parallel Execution<a class="anchor" aria-label="anchor" href="#parallel-execution"></a>
</h2>
<p>gnucashr uses RcppParallel for high-performance simulations:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Parallel Monte Carlo (default)</span></span>
<span><span class="va">mc_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/forecast_expr.html">forecast_expr</a></span><span class="op">(</span><span class="va">config</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/lf_monte_carlo.html">lf_monte_carlo</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10000</span>, params <span class="op">=</span> <span class="va">params</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/lf_collect.html">lf_collect</a></span><span class="op">(</span>parallel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Sequential execution (for debugging)</span></span>
<span><span class="va">mc_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/forecast_expr.html">forecast_expr</a></span><span class="op">(</span><span class="va">config</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/lf_monte_carlo.html">lf_monte_carlo</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10000</span>, params <span class="op">=</span> <span class="va">params</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/lf_collect.html">lf_collect</a></span><span class="op">(</span>parallel <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Parallel scenario projection</span></span>
<span><span class="va">scenarios</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/parallel_project_scenarios.html">parallel_project_scenarios</a></span><span class="op">(</span></span>
<span>  base_revenue <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50000</span>, <span class="fl">70000</span>, <span class="fl">7000</span><span class="op">)</span>,  <span class="co"># By entity</span></span>
<span>  growth_matrix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.03</span>, <span class="fl">0.05</span>, <span class="fl">0.08</span><span class="op">)</span>,  <span class="co"># Low, base, high</span></span>
<span>    nrow <span class="op">=</span> <span class="fl">3</span>, ncol <span class="op">=</span> <span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span>,</span>
<span>  n_periods <span class="op">=</span> <span class="fl">12</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="audited-forecasting">Audited Forecasting<a class="anchor" aria-label="anchor" href="#audited-forecasting"></a>
</h2>
<p>Track all forecast operations with audit logging:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create audited forecast</span></span>
<span><span class="va">forecast</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/forecast_expr.html">forecast_expr</a></span><span class="op">(</span><span class="va">config</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/lf_grow.html">lf_grow</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="fl">0.05</span>, months <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Collect with audit trail</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/audited_forecast.html">audited_forecast</a></span><span class="op">(</span><span class="va">forecast</span>, <span class="st">"Q1 2025 Base Case"</span><span class="op">)</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/audited_collect.html">audited_collect</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get data and log</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/logged_value.html">logged_value</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="va">log</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/logged_log.html">logged_log</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Write audit trail</span></span>
<span><span class="fu"><a href="../reference/write_forecast_audit.html">write_forecast_audit</a></span><span class="op">(</span><span class="va">result</span>, <span class="st">"forecast-audit.txt"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="safe-error-handling">Safe Error Handling<a class="anchor" aria-label="anchor" href="#safe-error-handling"></a>
</h2>
<p>Use the Result monad for safe operations:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Safe Monte Carlo</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/safe_quick_monte_carlo.html">safe_quick_monte_carlo</a></span><span class="op">(</span><span class="va">config</span>, n_sims <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/result_match.html">result_match</a></span><span class="op">(</span><span class="va">result</span>,</span>
<span>  ok_fn <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Median outcome: "</span>, <span class="fu"><a href="../reference/format_currency.html">format_currency</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">summary</span><span class="op">$</span><span class="va">p50</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  err_fn <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning</a></span><span class="op">(</span><span class="st">"Simulation failed: "</span>, <span class="va">e</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Safe sensitivity</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/safe_quick_sensitivity.html">safe_quick_sensitivity</a></span><span class="op">(</span><span class="va">config</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="../reference/is_ok.html">is_ok</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/plot_sensitivity.html">plot_sensitivity</a></span><span class="op">(</span><span class="fu"><a href="../reference/unwrap.html">unwrap</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="reactive-forecasting-for-quarto">Reactive Forecasting for Quarto<a class="anchor" aria-label="anchor" href="#reactive-forecasting-for-quarto"></a>
</h2>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.posit.co/" class="external-link">shiny</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Reactive configuration</span></span>
<span><span class="va">config_reactive</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html" class="external-link">reactive</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    entities <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      corp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        revenue <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">revenue</span>,</span>
<span>        growth_rate <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">growth</span>,</span>
<span>        operating_rate <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">operating</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Reactive forecast</span></span>
<span><span class="va">forecast_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reactive_forecast.html">reactive_forecast</a></span><span class="op">(</span></span>
<span>  <span class="va">config_reactive</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html" class="external-link">reactive</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">growth_rate</span><span class="op">)</span>,</span>
<span>  months <span class="op">=</span> <span class="fl">12</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Reactive Monte Carlo</span></span>
<span><span class="va">mc_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reactive_monte_carlo.html">reactive_monte_carlo</a></span><span class="op">(</span></span>
<span>  <span class="va">config_reactive</span>,</span>
<span>  n_sims <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html" class="external-link">reactive</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">growth_mean</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html" class="external-link">reactive</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">growth_sd</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use in outputs</span></span>
<span><span class="va">output</span><span class="op">$</span><span class="va">forecast_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html" class="external-link">renderPlot</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/plot_monte_carlo.html">plot_monte_carlo</a></span><span class="op">(</span><span class="fu">mc_result</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="performance-benchmarks">Performance Benchmarks<a class="anchor" aria-label="anchor" href="#performance-benchmarks"></a>
</h2>
<p>gnucashr achieves significant speedups with RcppParallel:</p>
<table class="table">
<thead><tr class="header">
<th>Operation</th>
<th>R (serial)</th>
<th>Rcpp (parallel)</th>
<th>Speedup</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Monte Carlo 10K sims</td>
<td>~3 sec</td>
<td>~0.05 sec</td>
<td><strong>60x</strong></td>
</tr>
<tr class="even">
<td>Sensitivity 125 scenarios</td>
<td>~5 sec</td>
<td>~0.5 sec</td>
<td><strong>10x</strong></td>
</tr>
<tr class="odd">
<td>5-scenario comparison</td>
<td>~0.5 sec</td>
<td>~0.1 sec</td>
<td><strong>5x</strong></td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="best-practices">Best Practices<a class="anchor" aria-label="anchor" href="#best-practices"></a>
</h2>
<ol style="list-style-type: decimal">
<li><p><strong>Build Lazy, Execute Once</strong>: Compose your forecast
pipeline, then call <code><a href="../reference/lf_collect.html">lf_collect()</a></code> only when you need
results.</p></li>
<li><p><strong>Use Deterministic Seeds</strong>: Always set
<code>seed</code> for reproducible Monte Carlo results.</p></li>
<li><p><strong>Parallel by Default</strong>: Leave
<code>parallel = TRUE</code> for production; use
<code>parallel = FALSE</code> only for debugging.</p></li>
<li><p><strong>Audit Important Forecasts</strong>: Use
<code><a href="../reference/audited_forecast.html">audited_forecast()</a></code> for any projections that will be shared
or used for decisions.</p></li>
<li><p><strong>Validate Inputs</strong>: Use
<code><a href="../reference/validate_forecast_params.html">validate_forecast_params()</a></code> before running expensive
simulations.</p></li>
</ol>
</div>
<div class="section level2">
<h2 id="next-steps">Next Steps<a class="anchor" aria-label="anchor" href="#next-steps"></a>
</h2>
<ul>
<li>
<a href="getting-started.html">Getting Started</a>: Basic gnucashr
usage</li>
<li>
<a href="consolidation.html">Multi-Book Consolidation</a>: Managing
multiple entities</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://tinyland.dev" class="external-link">Jess Sullivan</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
