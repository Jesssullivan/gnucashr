# gnucashr Bazel Configuration
# Remote caching enabled for fast incremental builds

# ============================================================
# Build Settings
# ============================================================

# C++ standard and optimization
build --cxxopt=-std=c++17
build --copt=-O2
build --copt=-fPIC

# OpenMP support for RcppParallel
build --copt=-fopenmp
build --linkopt=-fopenmp

# TBB for RcppParallel threading
build --linkopt=-ltbb

# ============================================================
# Remote Caching - Disabled (anonymous access deprecated)
# ============================================================
#
# BuildBuddy anonymous access is deprecated as of 2026.
# To enable remote caching, either:
# 1. Create a BuildBuddy account and set BUILDBUDDY_API_KEY
# 2. Run a self-hosted bazel-remote instance
#
# For now, rely on local Bazel cache only.
# Full build caching is handled by Nix + Attic.

# Uncomment to enable BuildBuddy with API key:
# build --remote_cache=grpcs://remote.buildbuddy.io
# build --remote_header=x-buildbuddy-api-key=${BUILDBUDDY_API_KEY}

# Uncomment for self-hosted bazel-remote:
# build --remote_cache=http://localhost:9090

# ============================================================
# CI Configuration
# ============================================================

# CI preset - faster builds, more caching
build:ci --remote_upload_local_results=true
build:ci --jobs=4
build:ci --verbose_failures

# Local preset - disable remote for offline work
build:local --remote_cache=
build:local --bes_backend=
build:local --bes_results_url=

# ============================================================
# Test Settings
# ============================================================

test --test_output=errors
test --test_verbose_timeout_warnings

# ============================================================
# Platform Settings
# ============================================================

# Linux
build:linux --copt=-D_GLIBCXX_USE_CXX11_ABI=1

# macOS
build:macos --copt=-D_DARWIN_C_SOURCE

# ============================================================
# Startup Options (performance)
# ============================================================

# Keep Bazel server running for faster incremental builds
startup --host_jvm_args=-Xmx2g

# ============================================================
# User Configuration (gitignored)
# ============================================================

# Import user-specific configuration if it exists
try-import %workspace%/.bazelrc.user
